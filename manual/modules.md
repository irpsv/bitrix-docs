# Модули

Официальное определение Битрикс:
> Модуль - это модель данных и API для доступа к этим данным. Статические методы классов модуля могут вызываться в компонентах, шаблонах, других модулях. Также внутри контекста Bitrix Framework могут создаваться экземпляры классов.

Собственно данным определением можно только подтереться и забыть как страшный сон.

Модули - это набор компонентов, административных страниц, файлов бизнес-логики объедененных одним контекстом (модули в обычном их понимании).
Каждый модуль может содержать:
- административные страницы и сервисы
- файлы установки/удаления
- конфигурацию (конфиг файл, который правиться через админку)
- компоненты
- бизнес-логику

## Структура

Список файлов:
- include.php
- options.php
- lib/
- lang/
  - папки языковых файлов
- admin/
  - menu.php
  - административные страницы...
- components/
- install/
  - index.php

Файл **include.php** подключается при подключении модуля (вызов метода `CModule::includeModule`). Подключение файлов можно осуществлять либо с помощью [стандартного функционала](https://dev.1c-bitrix.ru/api_d7/bitrix/main/loader/registerautoloadclasses.php) Битрикс, либо с помощью [PSR-4](https://www.php-fig.org/psr/psr-4/) (рекомендуется).  
Файл **options.php** содержит конфигурацию модуля (настройки модуля редактируемые через админку). В данный конфиг, нужно скидывать все константы и различные регулируемые параметры используемые в компонентах или сущностях.  
Директория **lib** содержит в себе все исходники модуля.  
Директория **admin** содержит в себе административные страницы, за исключением файла **menu.php**.  
Файл **admin/menu.php** содержит конфигурацию административного меню.  
Директория **components** содержит компоненты модуля.  
Директория **install** содержит в себе файлы и скрипты, используемые при установки данного модуля в Битрикс.  
Файл **install/index.php** содержит в себе скрипт инсталяции. Именно данный класс вызывается при установке модуля.

[Пример реализации](https://github.com/irpsv/bitrix-module/tree/master/src).

## Административные страницы

Битрикс не сканирует автоматически директории модулей в поисках административных страниц, поэтому при установке модуля административные страницы необходимо скопировать в директорию `bitrix/admin`.
Однако лучше/правильнее, не копировать физически файлы, а создавать символьные ссылки на страницы.
[Подробнее про административные страницы](admin-pages.md).

## Компоненты модуля

Аналогично административным страницам, Битрикс не сопостоявляется вендора компонента и имена модулей, поэтому компоненты при установке необходимо копировать в директория `bitrix/components`.
Однако лучше/правильнее, не копировать физически файлы, а создать символьную ссылку на директорию `components` с именем модуля в качестве имени вендора (наглядно продемонстрировано в [здесь](https://github.com/irpsv/bitrix-module/tree/master/src/install/index.php)).

## Структура БД

Для работы большинства модулей, нужно где-то хранить информацию.
Если говорить про Битрикс, то тут несколько вариантов:
1. кастомные таблицы - не очень удачный, см. плюсы инфоблока;
2. инфоблоки - идеален, т.к. инфоблоки используются везде, к ним все привыкли, все знают как с ними работать и в случае чего их легко можно кастомизировать (добавить функциональное поле/свойство);
3. highload - это вообще не вариант, кастрированные инфоблоки со странной структурой без адекватного API.

При использовании инфоблоков, нужно делать привязку ТОЛЬКО в символьному коду инфоблока, и относиться к этому коду нужно как к имени таблицы.
Для каждого создаваемого инфоблока должен быть свой `DataMapper`, который будет создавать инфоблоки/свойства/разделы/элементы при инсталяции модуля (и удалять при деинстлации).
Использовать созданный маппер для запросов **не желательно**, чтобы минимально отходить от стандартного API (для дальнейшей поддержки).
